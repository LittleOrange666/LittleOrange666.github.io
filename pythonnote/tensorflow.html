<html>

<head>
    <title>python tensorflow</title>
    <base target="_top">
    <link href="/style/codehilite.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8" crossorigin="anonymous"></script>
    <style type="text/css">
    #top_area{
        position: fixed;
        left:  0px;
        right: 0px;
    }
    #main_area {
        width: 80%;
        padding-top: 50px;
    }
    </style>
</head>

<body>
    <div id="top_area">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <a class="navbar-brand" href="#"></a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="https://littleorange666.github.io/">首頁</a>
                        </li>
                </div>
            </div>
        </nav>
    </div>
    <div id="main_area" class="markdown-body container-fluid comment-enabled" data-hard-breaks="true">
        <h1 id="tensorflow">tensorflow</h1>
<p>先import<br>
因為和通常numpy、matplotlib一起用，所以開頭要寫</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">'font.sans-serif'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Microsoft JhengHei'</span><span class="p">]</span> <span class="c1"># 正常顯示中文</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">'axes.unicode_minus'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># 正常顯示負號</span>
</code></pre></div>

<h2 id="_1">基本</h2>
<h3 id="_2">常用資料型別</h3>
<h4 id="tftensor">張量 tf.Tensor</h4>
<p>基本有點像np.ndarray<br>
但可以對它進行操作(tf.Operation)但不立即執行(在tensorflow 1)<br>
在tensorflow 2中可用tf.Tensor::numpy()轉換成np.ndarray</p>
<h4 id="tfvariable">變數 tf.Variable</h4>
<p>此類別用以維護一個張量，可以對其進行操作、讀寫，通常用於紀錄模型參數</p>
<h4 id="tfoperation">操作 tf.Operation</h4>
<p>用於對張量/變數/Session進行操作</p>
<h3 id="_3">常用張量計算</h3>
<h4 id="_4">加/減</h4>
<p>直接用加號/減號</p>
<h4 id="_5">對應值相乘</h4>
<p>用</p>
<div class="codehilite"><pre><span></span><code><span class="n">tf</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">)</span>
</code></pre></div>

<h4 id="_6">矩陣相乘</h4>
<p>用</p>
<div class="codehilite"><pre><span></span><code><span class="n">tf</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">)</span>
</code></pre></div>

<h4 id="_7">平方</h4>
<p>用</p>
<div class="codehilite"><pre><span></span><code><span class="n">tf</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">)</span>
</code></pre></div>

<h4 id="_8">根號</h4>
<p>用</p>
<div class="codehilite"><pre><span></span><code><span class="n">tf</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">)</span>
</code></pre></div>

<h4 id="_9">自定義</h4>
<p>除了標準的張量計算外，還可以用<code>@tf.function</code>來建立自定義的張量計算</p>
<h3 id="eager-execution">關於eager execution</h3>
<p>eager execution表示所有計算都立即執行<br>
在tensorflow 2默認是啟用的<br>
可用以下任一行來禁用</p>
<div class="codehilite"><pre><span></span><code><span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">disable_v2_behavior</span><span class="p">()</span> <span class="c1"># 禁用tensorflow 2全域特性防止出RuntimeError</span>
<span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">disable_eager_execution</span><span class="p">()</span> <span class="c1"># 禁用eager execution防止出RuntimeError</span>
</code></pre></div>

<p>若禁用eager execution，則計算結果必須通過sess.run來讀取<br>
但可以利用占位符作計算，把資料留到輸出結果時再輸入</p>
<h2 id="_10">架構</h2>
<h3 id="_11">靜態圖</h3>
<p>需禁用eager execution<br>
靜態圖將"定義"與"執行"分離<br>
預先定義好架構與損失後，建立Session進行訓練</p>
<h4 id="_12">靜態圖架構</h4>
<p>靜態圖的架構包含占位符、模型參數、損失函數和梯度下降器</p>
<ul>
<li>占位符: tf.Tensor<br>
  占位符表示模型中可輸入資料的空位<br>
  語法：</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">名稱</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="s2">"float"</span><span class="p">)</span>
</code></pre></div>

<ul>
<li>模型參數: tf.Variable<br>
  模型參數是模型中要透過訓練求得的值<br>
  語法：</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">名稱</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">初始值</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">名稱</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span>
</code></pre></div>

<ul>
<li>損失函數: tf.Tensor<br>
  損失函數是一個用於判斷正確程度的值，應為一個透過對占位符及模型參數作數學計算後的到的張量</li>
<li>梯度下降器: tf.Operation<br>
  梯度下降器是用於反向修正的算法，通常不會自己寫<br>
  語法：</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">global_step</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">'global_step'</span><span class="p">,</span> <span class="n">trainable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">GradientDescentOptimizer</span><span class="p">(</span><span class="n">learning_rate</span><span class="p">)</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">損失函數</span><span class="p">,</span> <span class="n">global_step</span><span class="p">)</span>
</code></pre></div>

<h4 id="session">Session建立與使用</h4>
<p>主要訓練部分需要建立一個Session<br>
語法：</p>
<div class="codehilite"><pre><span></span><code><span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">v1</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">())</span> <span class="c1"># 初始化變數</span>
    <span class="c1"># 主程式</span>
</code></pre></div>

<p>sess.run有以下功能：</p>
<ul>
<li>sess.run(Operation) 進行操作</li>
<li>sess.run(Tensor|Variable) 取出值</li>
</ul>
<p>使用<code>sess.run(optimizer)</code>可進行訓練<br>
使用<code>sess.run(損失函數)</code>可求出損失值<br>
這兩個操作都需要輸入資料<br>
使用<code>sess.run(模型參數)</code>可取出模型參數</p>
    </div>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            config: ["MMLorHTML.js"],
            jax: ["input/TeX", "output/HTML-CSS", "output/NativeMML"],
            extensions: ["MathMenu.js", "MathZoom.js"],
            enable_dollar_delimiter: true
        });
        </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
</body>

</html>