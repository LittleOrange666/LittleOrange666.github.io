"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};var _createClass=function(){function e(a,r){for(var n=0;n<r.length;n++){var e=r[n];e.enumerable=e.enumerable||false;e.configurable=true;if("value"in e)e.writable=true;Object.defineProperty(a,e.key,e)}}return function(a,r,n){if(r)e(a.prototype,r);if(n)e(a,n);return a}}();function _classCallCheck(a,r){if(!(a instanceof r)){throw new TypeError("Cannot call a class as a function")}}var zx="center";var zz="mousemove";var aww="px 標楷體";var af="";var ah="";var aj="uparea";var yr="rounddisplay";var ap="reset_btn";var aq="canvas";var fd="x";var az="y";var gv="兵";var gw="卒";var gx="炮";var gy="砲";var gz="俥";var hb="車";var hc="傌";var hd="馬";var hf="相";var hg="象";var hh="仕";var hj="士";var hk="帥";var hl="將";var aix="#E3CF57";var hp="#FF0000";var aud="#000000";var ih="number";var cb="eaten";var cc="from";var cd="to";var yu="紅方(玩家)";var yv="黑方(電腦)";var yw=" 第";var yx="回合";var zt="2d";var ajh="#888888";var aub="#F0E68C";var avz="#00FFFF";var awy="#00FF00";var axc="你贏了";var axk="你輸了";var axp="和局";var dh=function a(r){return document.getElementById(r)};var uparea=dh(aj);var rounddisplay=dh(yr);var reset_btn=dh(ap);var canvas=dh(aq);reset_btn.onclick=function(){zy();axn.reset()};var awv=Math.floor;var uv=function(){function e(a,r){_classCallCheck(this,e);this.x=a;this.y=r}_createClass(e,[{key:"dl",value:function a(r,n){if(n===undefined){return new e(this.x+r.x,this.y+r.y)}return new e(this.x+r,this.y+n)}},{key:"dp",value:function a(r,n){if(n===undefined){return new e(this.x-r.x,this.y-r.y)}return new e(this.x-r,this.y-n)}},{key:"avs",value:function a(r){return new e(this.x*r,this.y*r)}},{key:"eh",value:function a(){return new e(this.y,-this.x)}},{key:"ek",value:function a(){return new e(-this.y,this.x)}},{key:"eu",value:function a(r){return this.x==r.x&&this.y==r.y}}],[{key:"fromXYObj",value:function a(r){return new e(r[fd],r[az])}}]);return e}();uv.facings=[new uv(1,1),new uv(1,0),new uv(1,-1),new uv(0,-1),new uv(-1,-1),new uv(-1,0),new uv(-1,1),new uv(0,1)];uv.fourfacings=[new uv(1,0),new uv(0,-1),new uv(-1,0),new uv(0,1)];uv.obfacings=[new uv(1,1),new uv(1,-1),new uv(-1,1),new uv(-1,-1)];var axi=function(){function a(){_classCallCheck(this,a)}_createClass(a,null,[{key:"reverse",value:function a(r){if(r==1)return 2;if(r==2)return 1;return r}}]);return a}();axi.INVALID=-1;axi.NOTHING=0;axi.RED=1;axi.BLACK=2;var ahd=function a(){_classCallCheck(this,a)};ahd.INVALID=-1;ahd.NOTHING=0;ahd.PAWN=1;ahd.CANNON=2;ahd.ROOK=3;ahd.HORSE=4;ahd.JUMBO=5;ahd.KNIGHT=6;ahd.vm=7;var xu=function(){function n(a,r){_classCallCheck(this,n);this.aun=a;this.no=r}_createClass(n,[{key:"gm",value:function a(){if(this.aun>0&&this.no>0&&this.aun<3&&this.no<8){return n.words[this.no-1][this.aun-1]}return af}},{key:"go",value:function a(){return n.colors[this.aun]}},{key:"hv",value:function a(){return new n(this.aun,this.no)}}]);return n}();xu.STARTPOS=[null,[new uv(0,3),new uv(2,3),new uv(4,3)],new uv(1,2),new uv(0,0),new uv(1,0),new uv(2,0),new uv(3,0),new uv(4,0)];xu.words=[[gv,gw],[gx,gy],[gz,hb],[hc,hd],[hf,hg],[hh,hj],[hk,hl]];xu.colors=[aix,hp,aud];xu.NOTHING=new xu(0,0);xu.INVALID=new xu(-1,-1);var Chessboard=function(){function n(a){_classCallCheck(this,n);this.hu=a;this.reset()}_createClass(n,[{key:"hv",value:function a(){var r=new n(false);r.array=this.array.reduce(function(a,r){a[a.length]=r.concat();return a},new Array);return r}},{key:"ib",value:function a(r){if((typeof r==="undefined"?"undefined":_typeof(r))!=ih){r=1}if(this.actions.length>0){var n=this.actions[this.actions.length-1];this.actions.length=this.actions.length-1;if(n[cb].no==ahd.vm){this.status=0}var e=n[cc];var t=n[cd];var i=n[cb];var v=this.lm(t);this.array[e.x][e.y]=v;this.array[t.x][t.y]=i;this.yn();if(r>=2){this.ib(r-1)}else{this.selected=null;this.selecteds=new Array}}}},{key:"reset",value:function a(){this.array=new Array;this.round=axi.RED;this.status=0;this.selected=null;this.selecteds=new Array;this.actions=new Array;this.roundcount=1;for(var r=0;r<9;r++){var n=new Array;for(var e=0;e<10;e++){n[e]=xu.NOTHING}this.array[r]=n}for(var t=1;t<8;t++){var i=xu.STARTPOS[t];if(t==1){for(var v=0;v<i.length;v++){var u=i[v];this.array[u.x][u.y]=new xu(axi.BLACK,t);this.array[8-u.x][u.y]=new xu(axi.BLACK,t);this.array[u.x][9-u.y]=new xu(axi.RED,t);this.array[8-u.x][9-u.y]=new xu(axi.RED,t)}}else{this.array[i.x][i.y]=new xu(axi.BLACK,t);this.array[8-i.x][i.y]=new xu(axi.BLACK,t);this.array[i.x][9-i.y]=new xu(axi.RED,t);this.array[8-i.x][9-i.y]=new xu(axi.RED,t)}}if(this.hu){document.getElementById(yr).innerHTML=(this.round==axi.RED?yu:yv)+yw+this.roundcount+yx}}},{key:"ld",value:function a(r){return-1<r.x&&r.x<9&&-1<r.y&&r.y<10}},{key:"lm",value:function a(r){if(this.ld(r))return this.array[r.x][r.y];return xu.INVALID}},{key:"lu",value:function a(r,n){return n==axi.RED&&r.y>4||n==axi.BLACK&&r.y<5}},{key:"mg",value:function a(r,n){return r.x>2&&r.x<6&&(n==axi.RED&&r.y>6||n==axi.BLACK&&r.y<3)}},{key:"mt",value:function a(r,n){for(var e=0;e<9;e++){for(var t=0;t<10;t++){if(this.array[e][t].aun==r&&(n===undefined||this.array[e][t].no==n)){return new uv(e,t)}}}return null}},{key:"ni",value:function a(r,n){var e=new Array;for(var t=0;t<9;t++){for(var i=0;i<10;i++){if(this.array[t][i].aun==r&&(n===undefined||this.array[t][i].no==n)){e[e.length]=new uv(t,i)}}}return e}},{key:"nq",value:function a(r,n){var e=this.array[r.x][r.y];var t=new Array;var i=this.lu(r,e.aun);switch(e.no){case ahd.PAWN:var v=e.aun==axi.RED?-1:1;if(i){t[0]=r.dl(0,v)}else{t[0]=r.dl(0,v);t[1]=r.dl(1,0);t[2]=r.dl(-1,0)}break;case ahd.CANNON:for(var u=0;u<4;u++){var s=uv.fourfacings[u];var o=r.dl(s);while(this.lm(o).aun==axi.NOTHING){t[t.length]=o;o=o.dl(s)}o=o.dl(s);while(this.lm(o).aun!=axi.INVALID){if(this.lm(o).aun!=axi.NOTHING){t[t.length]=o;break}o=o.dl(s)}}break;case ahd.ROOK:for(var x=0;x<4;x++){var l=uv.fourfacings[x];var h=r.dl(l);while(this.lm(h).aun==axi.NOTHING){t[t.length]=h;h=h.dl(l)}if(this.lm(h).aun==axi.reverse(e.aun)){t[t.length]=h}}break;case ahd.HORSE:for(var f=0;f<4;f++){var w=uv.fourfacings[f];var c=r.dl(w);if(this.lm(c).aun==axi.NOTHING){t[t.length]=c.dl(w).dl(w.ek());t[t.length]=c.dl(w).dl(w.eh())}}break;case ahd.JUMBO:for(var y=0;y<4;y++){var d=uv.obfacings[y];var q=r.dl(d);if(this.lm(q).aun==axi.NOTHING){var m=q.dl(d);if(this.lu(m,e.aun)){t[t.length]=m}}}break;case ahd.KNIGHT:for(var g=0;g<4;g++){var k=uv.obfacings[g];var b=r.dl(k);if(this.mg(b,e.aun)){t[t.length]=b}}break;case ahd.vm:for(var A=0;A<4;A++){var N=uv.fourfacings[A];var C=r.dl(N);if(this.mg(C,e.aun)){t[t.length]=C}}break;default:break}var p=0;var I=axi.reverse(e.aun);var T=this.mt(I,ahd.vm);var E=this.mt(e.aun,ahd.vm);if(T&&E&&T.x>=0&&E.x>=0){var O=Math.min(E.y,T.y);var R=Math.max(E.y,T.y);if(e.no==ahd.vm){p=1;for(var D=O+1;D<R;D++){if(this.lm(new uv(T.x,D)).aun!=axi.NOTHING){p=0}}}else if(E.x==T.x&&T.x==r.x){var H=0;for(var S=O+1;S<R;S++){if(this.lm(new uv(T.x,S)).aun!=axi.NOTHING){H=H+1}}if(H<=1){p=1}}}var L=new Array;for(var M=0;M<t.length;M++){if((n||this.lm(t[M]).aun!=e.aun)&&this.ld(t[M])){if(p){if(e.no==ahd.vm){if(T.x==t[M].x)continue}else if(T.x!=t[M].x)continue}L[L.length]=t[M]}}return L}},{key:"afm",value:function a(r,n){if(this.ld(r)&&this.ld(n)){if(this.array[n.x][n.y].no==ahd.vm){this.status=axi.reverse(this.array[n.x][n.y].aun)}this.actions[this.actions.length]={from:r,to:n,eaten:this.array[n.x][n.y]};this.array[n.x][n.y]=this.array[r.x][r.y];this.array[r.x][r.y]=xu.NOTHING;if(this.hu&&this.status==0&&this.array[n.x][n.y].no>0){var e=0;for(var t=1;t<=4;t++){if(this.mt(axi.RED,t)||this.mt(axi.BLACK,t)){e++}}if(e==0){this.status=-1}if(e==1){if(this.mt(axi.RED,2)&&this.ni(axi.RED).length<3){this.status=-1}else if(this.mt(axi.BLACK,2)&&this.ni(axi.BLACK).length<3){this.status=-1}}}}}},{key:"yn",value:function a(){this.round=axi.reverse(this.round);if(this.round==axi.RED)this.roundcount++;if(this.hu){document.getElementById(yr).innerHTML=(this.round==axi.RED?yu:yv)+yw+this.roundcount+yx}}}]);return n}();var axn=new Chessboard(true);var aad={x:0,y:0};var axq=0;var axr=0;var awq=0;var axo;function zy(){var a=document.body.clientWidth;var r=window.screen.height-160-uparea.clientHeight;awq=Math.min(a/18,r/20);canvas.width=axq=awv(awq*18);canvas.height=axr=awv(awq*20);if(a/18<r/20){aad.x=0;aad.y=awv((r-axr)/2)+uparea.clientHeight}else{aad.x=awv((a-axq)/2);aad.y=uparea.clientHeight}axo=canvas.getContext(zt);axo.lineWidth=awv(awq/10);axo.textAlign=zx}zy();var aac={x:0,y:0};window.addEventListener(zz,function(a){aac.x=a.pageX-aad.x;aac.y=a.pageY-aad.y});function avi(a,r,n,e){axo.beginPath();axo.moveTo(awv(a),awv(r));axo.lineTo(awv(n),awv(e));axo.stroke()}function aui(a,r,n){axo.beginPath();axo.arc(awv(a),awv(r),awv(n),0,Math.PI*2);axo.stroke();axo.fill()}function ajv(a,r,n,e){axo.beginPath();axo.rect(awv(a),awv(r),awv(n),awv(e));axo.fill()}canvas.onclick=function(a){return abh()};function abh(){if(axn.status==0&&axn.round==axi.RED){var a=new uv(awv(aac.x/awq*.5),awv(aac.y/awq*.5));var r=axn.lm(a);if(r.aun==axn.round){if(axn.selected&&axn.selected.eu(a)){axn.selected=null;axn.selecteds=new Array}else{axn.selected=a;axn.selecteds=axn.nq(a)}}else if(axn.selected){for(var n=0;n<axn.selecteds.length;n++){var e=axn.selecteds[n];if(a.eu(e)){axn.afm(axn.selected,a);axn.selected=null;axn.selecteds=new Array;if(axn.status==0){axn.yn();window.setTimeout(function(){return acv(axi.BLACK,axi.RED,axn)},1e3)}break}}}}}function aft(a,r,n,e){var t=[0,5,18,20,15,10,8,1e4];var i=new Array;for(var v=0;v<9;v++){var u=new Array;for(var s=0;s<10;s++){u[s]=null}i[v]=u}var o=a.ni(r);for(var x=0;x<o.length;x++){var l=a.nq(o[x],n);var h=t[a.lm(o[x]).no];for(var f=0;f<l.length;f++){var w=l[f];if(i[w.x][w.y]==null){i[w.x][w.y]={min:h,max:h}}else{i[w.x][w.y].min=Math.min(i[w.x][w.y].min,h);i[w.x][w.y].max=Math.max(i[w.x][w.y].max,h)}}}return i}function acv(a,r,n){var e=[0,5,18,20,15,10,8,1e4];var t=n.hv();var i=t.ni(a);var v=new Array;for(var u=0;u<i.length;u++){var s=t.nq(i[u]);for(var o=0;o<s.length;o++){v[v.length]={from:i[u],to:s[o]}}}var x=v.length;var l=new Array;for(var h=0;h<x;h++){var f=0;var w=v[h];var c=t.lm(w[cd]);var y=t.lm(w[cc]);t.afm(w[cc],w[cd]);var d=aft(t,a);var q=aft(t,a,true);var m=aft(t,r);var g=aft(t,r,true);if(c.aun==r){f+=e[c.no]*3}var k=0;var b=0;var A=0;for(var N=0;N<9;N++){for(var C=0;C<10;C++){if(d[N][C]!=null&&g[N][C]!=null){A=Math.max(A,e[t.lm(new uv(N,C)).no])}}}for(var p=0;p<9;p++){for(var I=0;I<10;I++){var T=new uv(p,I);if(m[p][I]!=null){if(t.lm(T).no==ahd.vm){f-=1e8}if(q[p][I]==null){k=Math.max(k,e[t.lm(T).no]);f-=.1*Math.sqrt(e[t.lm(T).no])}else{k=Math.max(k,e[t.lm(T).no]-m[p][I].min)}}if(d[p][I]!=null&&A>e[t.lm(T).no]){if(g[p][I]==null){if(t.lm(T).no==ahd.vm){f+=1e6}b=Math.max(b,e[t.lm(T).no]);f+=.1*Math.sqrt(e[t.lm(T).no])}else{b=Math.max(b,e[t.lm(T).no]-d[p][I].min)}}}}f=f+b-k*3;t.ib();l[h]=f}var E=[v[awv(Math.random()*v.length)]];var O=l[0]-100;for(var R=0;R<x;R++){if(l[R]>O){O=l[R];E=[v[R]]}if(l[R]==O){E[E.length]=v[R]}}var D=E[awv(Math.random()*E.length)];n.afm(D[cc],D[cd]);if(n.status==0){n.yn()}}function axt(){axo.fillStyle=aix;axo.strokeStyle=aud;ajv(0,0,axq,axr);if(axn.actions.length>0){var a=axn.actions[axn.actions.length-1];axo.fillStyle=ajh;var r=awq*(2*a[cc].x+1),n=awq*(2*a[cc].y+1);ajv(r-awq,n-awq,2*awq,2*awq);r=awq*(2*a[cd].x+1);n=awq*(2*a[cd].y+1);ajv(r-awq,n-awq,2*awq,2*awq)}var i=axo.lineWidth;var e=1.5*i;var t=.5*i;avi(awq-e,awq-i,axq-awq+e,awq-i);avi(awq-i,awq-e,awq-i,axr-awq+e);avi(axq-awq+i,awq-e,axq-awq+i,axr-awq+e);avi(awq-e,axr-awq+i,axq-awq+e,axr-awq+i);avi(awq+t,awq+i,axq-awq-t,awq+i);avi(awq+i,awq+t,awq+i,axr-awq-t);avi(axq-awq-i,awq+t,axq-awq-i,axr-awq-t);avi(awq+t,axr-awq-i,axq-awq-t,axr-awq-i);for(var v=1;v<9;v++){avi(awq+i,awq*(2*v+1),axq-awq-i,awq*(2*v+1))}for(var u=1;u<8;u++){avi(awq*(2*u+1),awq+i,awq*(2*u+1),awq*9);avi(awq*(2*u+1),axr-awq*9,awq*(2*u+1),axr-awq-i)}var s=5;var o=[[1,1],[1,-1],[-1,-1],[-1,1]];for(var x=0;x<4;x++){var l=o[x];avi(axq/2+awq*2*l[0],axr/2+awq*5*l[1],axq/2-awq*2*l[0],axr/2+awq*9*l[1])}var h=function a(r,n){for(var e=0;e<2;e++){var t=o[e];avi(r+1.5*i*t[0],n+2*i*t[1],r+(2+s)*i*t[0],n+2*i*t[1]);avi(r+2*i*t[0],n+1.5*i*t[1],r+2*i*t[0],n+(2+s)*i*t[1])}};var f=function a(r,n){for(var e=2;e<4;e++){var t=o[e];avi(r+1.5*i*t[0],n+2*i*t[1],r+(2+s)*i*t[0],n+2*i*t[1]);avi(r+2*i*t[0],n+1.5*i*t[1],r+2*i*t[0],n+(2+s)*i*t[1])}};var w=function a(r,n){for(var e=0;e<4;e++){var t=o[e];avi(r+1.5*i*t[0],n+2*i*t[1],r+(2+s)*i*t[0],n+2*i*t[1]);avi(r+2*i*t[0],n+1.5*i*t[1],r+2*i*t[0],n+(2+s)*i*t[1])}};var c=[new uv(2,3),new uv(1,2),new uv(4,3)];for(var y=0;y<3;y++){var d=c[y];w(awq*(2*d.x+1),awq*(2*d.y+1));w(awq*(2*d.x+1),awq*(19-2*d.y));if(y<2){w(awq*(17-2*d.x),awq*(2*d.y+1));w(awq*(17-2*d.x),awq*(19-2*d.y))}}if(true){h(awq+i,awq*7);h(awq+i,awq*13);f(awq*17-i,awq*7);f(awq*17-i,awq*13)}axo.font=awv(awq)+aww;for(var q=0;q<9;q++){for(var m=0;m<10;m++){var g=axn.array[q][m];if(g.no>0){var k=new uv(awq*(2*q+1),awq*(2*m+1));var b=g.go();axo.fillStyle=aub;axo.strokeStyle=aud;aui(k.x,k.y,awq-1);axo.strokeStyle=b;aui(k.x,k.y,awq-1-2*i);axo.fillStyle=b;axo.fillText(g.gm(),k.x,k.y+awv(awq/4))}}}var A=function a(r,n){for(var e=0;e<4;e++){var t=o[e];avi(r+(.5*i-awq)*t[0],n+(1*i-awq)*t[1],r+((1+s)*i-awq)*t[0],n+(1*i-awq)*t[1]);avi(r+(1*i-awq)*t[0],n+(.5*i-awq)*t[1],r+(1*i-awq)*t[0],n+((1+s)*i-awq)*t[1])}};if(axn.selected){var N=axn.selected;axo.strokeStyle=avz;A(awq*(2*N.x+1),awq*(2*N.y+1));axo.strokeStyle=awy;for(var C=0;C<axn.selecteds.length;C++){var p=axn.selecteds[C];A(awq*(2*p.x+1),awq*(2*p.y+1))}}axo.font=awv(awq*3)+aww;axo.fillStyle=awy;if(axn.status==axi.RED){axo.fillText(axc,axq/2,axr/2)}if(axn.status==axi.BLACK){axo.fillText(axk,axq/2,axr/2)}if(axn.status==-1){axo.fillText(axp,axq/2,axr/2)}}window.setInterval(axt,100);