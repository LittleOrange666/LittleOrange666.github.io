"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};var _createClass=function(){function n(a,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(a,n.key,n)}}return function(a,r,e){if(r)n(a.prototype,r);if(e)n(a,e);return a}}();function _classCallCheck(a,r){if(!(a instanceof r)){throw new TypeError("Cannot call a class as a function")}}var zr="center";var zt="mousemove";var awo="px 標楷體";var af="";var ah="";var aj="uparea";var yi="rounddisplay";var ap="canvas";var eu="x";var av="y";var go="兵";var gp="卒";var gq="炮";var gr="砲";var gu="俥";var gv="車";var gw="傌";var gx="馬";var gy="相";var gz="象";var hb="仕";var hc="士";var hd="帥";var hf="將";var air="#E3CF57";var hj="#FF0000";var atx="#000000";var hx="number";var by="eaten";var bz="from";var cb="to";var yk="紅方(玩家)";var yn="黑方(電腦)";var yo=" 第";var yq="回合";var zn="2d";var ajb="#888888";var atv="#F0E68C";var avt="#00FFFF";var awq="#00FF00";var aww="你贏了";var axc="你輸了";var axj="和局";var cz=function a(r){return document.getElementById(r)};var uparea=cz(aj);var rounddisplay=cz(yi);var canvas=cz(ap);var awn=Math.floor;var ui=function(){function n(a,r){_classCallCheck(this,n);this.x=a;this.y=r}_createClass(n,[{key:"db",value:function a(r,e){if(e===undefined){return new n(this.x+r.x,this.y+r.y)}return new n(this.x+r,this.y+e)}},{key:"dj",value:function a(r,e){if(e===undefined){return new n(this.x-r.x,this.y-r.y)}return new n(this.x-r,this.y-e)}},{key:"avm",value:function a(r){return new n(this.x*r,this.y*r)}},{key:"dv",value:function a(){return new n(this.y,-this.x)}},{key:"dx",value:function a(){return new n(-this.y,this.x)}},{key:"eb",value:function a(r){return this.x==r.x&&this.y==r.y}}],[{key:"fromXYObj",value:function a(r){return new n(r[eu],r[av])}}]);return n}();ui.facings=[new ui(1,1),new ui(1,0),new ui(1,-1),new ui(0,-1),new ui(-1,-1),new ui(-1,0),new ui(-1,1),new ui(0,1)];ui.fourfacings=[new ui(1,0),new ui(0,-1),new ui(-1,0),new ui(0,1)];ui.obfacings=[new ui(1,1),new ui(1,-1),new ui(-1,1),new ui(-1,-1)];var axa=function(){function a(){_classCallCheck(this,a)}_createClass(a,null,[{key:"reverse",value:function a(r){if(r==1)return 2;if(r==2)return 1;return r}}]);return a}();axa.INVALID=-1;axa.NOTHING=0;axa.RED=1;axa.BLACK=2;var agx=function a(){_classCallCheck(this,a)};agx.INVALID=-1;agx.NOTHING=0;agx.PAWN=1;agx.CANNON=2;agx.ROOK=3;agx.HORSE=4;agx.JUMBO=5;agx.KNIGHT=6;agx.vg=7;var xm=function(){function e(a,r){_classCallCheck(this,e);this.aug=a;this.nf=r}_createClass(e,[{key:"gf",value:function a(){if(this.aug>0&&this.nf>0&&this.aug<3&&this.nf<8){return e.words[this.nf-1][this.aug-1]}return af}},{key:"gg",value:function a(){return e.colors[this.aug]}},{key:"hp",value:function a(){return new e(this.aug,this.nf)}}]);return e}();xm.STARTPOS=[null,[new ui(0,3),new ui(2,3),new ui(4,3)],new ui(1,2),new ui(0,0),new ui(1,0),new ui(2,0),new ui(3,0),new ui(4,0)];xm.words=[[go,gp],[gq,gr],[gu,gv],[gw,gx],[gy,gz],[hb,hc],[hd,hf]];xm.colors=[air,hj,atx];xm.NOTHING=new xm(0,0);xm.INVALID=new xm(-1,-1);var Chessboard=function(){function e(a){_classCallCheck(this,e);this.hn=a;this.reset()}_createClass(e,[{key:"hp",value:function a(){var r=new e(false);r.array=this.array.reduce(function(a,r){a[a.length]=r.concat();return a},new Array);return r}},{key:"hw",value:function a(r){if((typeof r==="undefined"?"undefined":_typeof(r))!=hx){r=1}if(this.actions.length>0){var e=this.actions[this.actions.length-1];this.actions.length=this.actions.length-1;if(e[by].nf==agx.vg){this.status=0}var n=e[bz];var t=e[cb];var i=e[by];var x=this.ld(t);this.array[n.x][n.y]=x;this.array[t.x][t.y]=i;this.yf();if(r>=2){this.hw(r-1)}else{this.selected=null;this.selecteds=new Array}}}},{key:"reset",value:function a(){this.array=new Array;this.round=axa.RED;this.status=0;this.selected=null;this.selecteds=new Array;this.actions=new Array;this.roundcount=1;for(var r=0;r<9;r++){var e=new Array;for(var n=0;n<10;n++){e[n]=xm.NOTHING}this.array[r]=e}for(var t=1;t<8;t++){var i=xm.STARTPOS[t];if(t==1){for(var x=0;x<i.length;x++){var s=i[x];this.array[s.x][s.y]=new xm(axa.BLACK,t);this.array[8-s.x][s.y]=new xm(axa.BLACK,t);this.array[s.x][9-s.y]=new xm(axa.RED,t);this.array[8-s.x][9-s.y]=new xm(axa.RED,t)}}else{this.array[i.x][i.y]=new xm(axa.BLACK,t);this.array[8-i.x][i.y]=new xm(axa.BLACK,t);this.array[i.x][9-i.y]=new xm(axa.RED,t);this.array[8-i.x][9-i.y]=new xm(axa.RED,t)}}if(this.hn){document.getElementById(yi).innerHTML=(this.round==axa.RED?yk:yn)+yo+this.roundcount+yq}}},{key:"kx",value:function a(r){return r&&-1<r.x&&r.x<9&&-1<r.y&&r.y<10}},{key:"ld",value:function a(r){if(this.kx(r))return this.array[r.x][r.y];return xm.INVALID}},{key:"lk",value:function a(r,e){return e==axa.RED&&r.y>4||e==axa.BLACK&&r.y<5}},{key:"ly",value:function a(r,e){return r.x>2&&r.x<6&&(e==axa.RED&&r.y>6||e==axa.BLACK&&r.y<3)}},{key:"mm",value:function a(r,e){for(var n=0;n<9;n++){for(var t=0;t<10;t++){if(this.array[n][t].aug==r&&(e===undefined||this.array[n][t].nf==e)){return new ui(n,t)}}}return null}},{key:"mv",value:function a(r,e){var n=new Array;for(var t=0;t<9;t++){for(var i=0;i<10;i++){if(this.array[t][i].aug==r&&(e===undefined||this.array[t][i].nf==e)){n[n.length]=new ui(t,i)}}}return n}},{key:"nj",value:function a(r,e){var n=this.array[r.x][r.y];var t=new Array;var i=this.lk(r,n.aug);switch(n.nf){case agx.PAWN:var x=n.aug==axa.RED?-1:1;if(i){t[0]=r.db(0,x)}else{t[0]=r.db(0,x);t[1]=r.db(1,0);t[2]=r.db(-1,0)}break;case agx.CANNON:for(var s=0;s<4;s++){var u=ui.fourfacings[s];var v=r.db(u);while(this.ld(v).aug==axa.NOTHING){t[t.length]=v;v=v.db(u)}v=v.db(u);while(this.ld(v).aug!=axa.INVALID){if(this.ld(v).aug!=axa.NOTHING){t[t.length]=v;break}v=v.db(u)}}break;case agx.ROOK:for(var f=0;f<4;f++){var l=ui.fourfacings[f];var h=r.db(l);while(this.ld(h).aug==axa.NOTHING){t[t.length]=h;h=h.db(l)}if(this.ld(h).aug==axa.reverse(n.aug)){t[t.length]=h}}break;case agx.HORSE:for(var w=0;w<4;w++){var o=ui.fourfacings[w];var c=r.db(o);if(this.ld(c).aug==axa.NOTHING){t[t.length]=c.db(o).db(o.dx());t[t.length]=c.db(o).db(o.dv())}}break;case agx.JUMBO:for(var y=0;y<4;y++){var g=ui.obfacings[y];var d=r.db(g);if(this.ld(d).aug==axa.NOTHING){var j=d.db(g);if(this.lk(j,n.aug)){t[t.length]=j}}}break;case agx.KNIGHT:for(var m=0;m<4;m++){var b=ui.obfacings[m];var k=r.db(b);if(this.ly(k,n.aug)){t[t.length]=k}}break;case agx.vg:for(var A=0;A<4;A++){var N=ui.fourfacings[A];var C=r.db(N);if(this.ly(C,n.aug)){t[t.length]=C}}break;default:break}var p=0;var z=axa.reverse(n.aug);var I=this.mm(z,agx.vg);var T=this.mm(n.aug,agx.vg);if(I&&T&&I.x>=0&&T.x>=0){var E=Math.min(T.y,I.y);var O=Math.max(T.y,I.y);if(n.nf==agx.vg){p=1;for(var R=E+1;R<O;R++){if(this.ld(new ui(I.x,R)).aug!=axa.NOTHING){p=0}}}else if(T.x==I.x&&I.x==r.x){var D=0;for(var H=E+1;H<O;H++){if(this.ld(new ui(I.x,H)).aug!=axa.NOTHING){D=D+1}}if(D<=1){p=1}}}var S=new Array;for(var L=0;L<t.length;L++){if((e||this.ld(t[L]).aug!=n.aug)&&this.kx(t[L])){if(p){if(n.nf==agx.vg){if(I.x==t[L].x)continue}else if(I.x!=t[L].x)continue}S[S.length]=t[L]}}return S}},{key:"afg",value:function a(r,e){if(this.kx(r)&&this.kx(e)){if(this.array[e.x][e.y].nf==agx.vg){this.status=axa.reverse(this.array[e.x][e.y].aug)}this.actions.push({from:r,to:e,eaten:this.array[e.x][e.y]});this.array[e.x][e.y]=this.array[r.x][r.y];this.array[r.x][r.y]=xm.NOTHING;if(this.hn&&this.status==0&&this.array[e.x][e.y].nf>0){var n=0;for(var t=1;t<=4;t++){if(this.mm(axa.RED,t)||this.mm(axa.BLACK,t)){n++}}if(n==0){this.status=-1}if(n==1){if(this.mm(axa.RED,2)&&this.mv(axa.RED).length<3){this.status=-1}else if(this.mm(axa.BLACK,2)&&this.mv(axa.BLACK).length<3){this.status=-1}}}}}},{key:"yf",value:function a(){this.round=axa.reverse(this.round);if(this.round==axa.RED)this.roundcount++;if(this.hn){document.getElementById(yi).innerHTML=(this.round==axa.RED?yk:yn)+yo+this.roundcount+yq}}}]);return e}();var axh=new Chessboard(true);var zx={x:0,y:0};var axk=0;var axl=0;var awj=0;var axi;function zs(){var a=document.body.clientWidth;var r=window.screen.height-160-uparea.clientHeight;awj=Math.min(a/18,r/20);canvas.width=axk=awn(awj*18);canvas.height=axl=awn(awj*20);if(a/18<r/20){zx.x=0;zx.y=awn((r-axl)/2)+uparea.clientHeight}else{zx.x=awn((a-axk)/2);zx.y=uparea.clientHeight}axi=canvas.getContext(zn);axi.lineWidth=awn(awj/10);axi.textAlign=zr}zs();var zw={x:0,y:0};window.addEventListener(zt,function(a){zw.x=a.pageX-zx.x;zw.y=a.pageY-zx.y});function avc(a,r,e,n){axi.beginPath();axi.moveTo(awn(a),awn(r));axi.lineTo(awn(e),awn(n));axi.stroke()}function auc(a,r,e){axi.beginPath();axi.arc(awn(a),awn(r),awn(e),0,Math.PI*2);axi.stroke();axi.fill()}function ajp(a,r,e,n){axi.beginPath();axi.rect(awn(a),awn(r),awn(e),awn(n));axi.fill()}canvas.onclick=function(a){return abb()};function abb(){if(axh.status==0&&axh.round==axa.RED){var a=new ui(awn(zw.x/awj*.5),awn(zw.y/awj*.5));var r=axh.ld(a);if(r.aug==axh.round){if(axh.selected&&axh.selected.eb(a)){axh.selected=null;axh.selecteds=new Array}else{axh.selected=a;axh.selecteds=axh.nj(a)}}else if(axh.selected){for(var e=0;e<axh.selecteds.length;e++){var n=axh.selecteds[e];if(a.eb(n)){axh.afg(axh.selected,a);axh.selected=null;axh.selecteds=new Array;if(axh.status==0){axh.yf();window.setTimeout(function(){return aco(axa.BLACK,axa.RED,axh)},1e3)}break}}}}}function afn(a,r,e,n){var t=[0,5,18,20,15,10,8,1e4];var i=new Array;for(var x=0;x<9;x++){var s=new Array;for(var u=0;u<10;u++){s[u]=null}i[x]=s}var v=a.mv(r);for(var f=0;f<v.length;f++){var l=a.nj(v[f],e);var h=t[a.ld(v[f]).nf];for(var w=0;w<l.length;w++){var o=l[w];if(i[o.x][o.y]==null){i[o.x][o.y]={min:h,max:h}}else{i[o.x][o.y].min=Math.min(i[o.x][o.y].min,h);i[o.x][o.y].max=Math.max(i[o.x][o.y].max,h)}}}return i}function aco(a,r,e){var n=[0,5,18,20,15,10,8,1e4];var t=e.hp();var i=t.mv(a);var x=new Array;for(var s=0;s<i.length;s++){var u=t.nj(i[s]);for(var v=0;v<u.length;v++){x[x.length]={from:i[s],to:u[v]}}}var f=x.length;var l=new Array;for(var h=0;h<f;h++){var w=0;var o=x[h];var c=t.ld(o[cb]);var y=t.ld(o[bz]);t.afg(o[bz],o[cb]);var g=afn(t,a);var d=afn(t,a,true);var j=afn(t,r);var m=afn(t,r,true);if(c.aug==r){w+=n[c.nf]*3}var b=0;var k=0;var A=0;for(var N=0;N<9;N++){for(var C=0;C<10;C++){if(g[N][C]!=null&&m[N][C]!=null){A=Math.max(A,n[t.ld(new ui(N,C)).nf])}}}for(var p=0;p<9;p++){for(var z=0;z<10;z++){var I=new ui(p,z);if(j[p][z]!=null){if(t.ld(I).nf==agx.vg){w-=1e8}if(d[p][z]==null){b=Math.max(b,n[t.ld(I).nf]);w-=.1*Math.sqrt(n[t.ld(I).nf])}else{b=Math.max(b,n[t.ld(I).nf]-j[p][z].min)}}if(g[p][z]!=null&&A>n[t.ld(I).nf]){if(m[p][z]==null){if(t.ld(I).nf==agx.vg){w+=1e6}k=Math.max(k,n[t.ld(I).nf]);w+=.1*Math.sqrt(n[t.ld(I).nf])}else{k=Math.max(k,n[t.ld(I).nf]-g[p][z].min)}}}}w=w+k-b*3;t.hw();l[h]=w}var T=[x[awn(Math.random()*x.length)]];var E=l[0]-100;for(var O=0;O<f;O++){if(l[O]>E){E=l[O];T=[x[O]]}if(l[O]==E){T[T.length]=x[O]}}var R=T[awn(Math.random()*T.length)];e.afg(R[bz],R[cb]);if(e.status==0){e.yf()}}function axm(){axi.fillStyle=air;axi.strokeStyle=atx;ajp(0,0,axk,axl);if(axh.actions.length>0){var a=axh.actions[axh.actions.length-1];axi.fillStyle=ajb;var r=awj*(2*a[bz].x+1),e=awj*(2*a[bz].y+1);ajp(r-awj,e-awj,2*awj,2*awj);r=awj*(2*a[cb].x+1);e=awj*(2*a[cb].y+1);ajp(r-awj,e-awj,2*awj,2*awj)}var i=axi.lineWidth;var n=1.5*i;var t=.5*i;avc(awj-n,awj-i,axk-awj+n,awj-i);avc(awj-i,awj-n,awj-i,axl-awj+n);avc(axk-awj+i,awj-n,axk-awj+i,axl-awj+n);avc(awj-n,axl-awj+i,axk-awj+n,axl-awj+i);avc(awj+t,awj+i,axk-awj-t,awj+i);avc(awj+i,awj+t,awj+i,axl-awj-t);avc(axk-awj-i,awj+t,axk-awj-i,axl-awj-t);avc(awj+t,axl-awj-i,axk-awj-t,axl-awj-i);for(var x=1;x<9;x++){avc(awj+i,awj*(2*x+1),axk-awj-i,awj*(2*x+1))}for(var s=1;s<8;s++){avc(awj*(2*s+1),awj+i,awj*(2*s+1),awj*9);avc(awj*(2*s+1),axl-awj*9,awj*(2*s+1),axl-awj-i)}var u=5;var v=[[1,1],[1,-1],[-1,-1],[-1,1]];for(var f=0;f<4;f++){var l=v[f];avc(axk/2+awj*2*l[0],axl/2+awj*5*l[1],axk/2-awj*2*l[0],axl/2+awj*9*l[1])}var h=function a(r,e){for(var n=0;n<2;n++){var t=v[n];avc(r+1.5*i*t[0],e+2*i*t[1],r+(2+u)*i*t[0],e+2*i*t[1]);avc(r+2*i*t[0],e+1.5*i*t[1],r+2*i*t[0],e+(2+u)*i*t[1])}};var w=function a(r,e){for(var n=2;n<4;n++){var t=v[n];avc(r+1.5*i*t[0],e+2*i*t[1],r+(2+u)*i*t[0],e+2*i*t[1]);avc(r+2*i*t[0],e+1.5*i*t[1],r+2*i*t[0],e+(2+u)*i*t[1])}};var o=function a(r,e){for(var n=0;n<4;n++){var t=v[n];avc(r+1.5*i*t[0],e+2*i*t[1],r+(2+u)*i*t[0],e+2*i*t[1]);avc(r+2*i*t[0],e+1.5*i*t[1],r+2*i*t[0],e+(2+u)*i*t[1])}};var c=[new ui(2,3),new ui(1,2),new ui(4,3)];for(var y=0;y<3;y++){var g=c[y];o(awj*(2*g.x+1),awj*(2*g.y+1));o(awj*(2*g.x+1),awj*(19-2*g.y));if(y<2){o(awj*(17-2*g.x),awj*(2*g.y+1));o(awj*(17-2*g.x),awj*(19-2*g.y))}}if(true){h(awj+i,awj*7);h(awj+i,awj*13);w(awj*17-i,awj*7);w(awj*17-i,awj*13)}axi.font=awn(awj)+awo;for(var d=0;d<9;d++){for(var j=0;j<10;j++){var m=axh.array[d][j];if(m.nf>0){var b=new ui(awj*(2*d+1),awj*(2*j+1));var k=m.gg();axi.fillStyle=atv;axi.strokeStyle=atx;auc(b.x,b.y,awj-1);axi.strokeStyle=k;auc(b.x,b.y,awj-1-2*i);axi.fillStyle=k;axi.fillText(m.gf(),b.x,b.y+awn(awj/4))}}}var A=function a(r,e){for(var n=0;n<4;n++){var t=v[n];avc(r+(.5*i-awj)*t[0],e+(1*i-awj)*t[1],r+((1+u)*i-awj)*t[0],e+(1*i-awj)*t[1]);avc(r+(1*i-awj)*t[0],e+(.5*i-awj)*t[1],r+(1*i-awj)*t[0],e+((1+u)*i-awj)*t[1])}};if(axh.selected){var N=axh.selected;axi.strokeStyle=avt;A(awj*(2*N.x+1),awj*(2*N.y+1));axi.strokeStyle=awq;for(var C=0;C<axh.selecteds.length;C++){var p=axh.selecteds[C];A(awj*(2*p.x+1),awj*(2*p.y+1))}}axi.font=awn(awj*3)+awo;axi.fillStyle=awq;if(axh.status==axa.RED){axi.fillText(aww,axk/2,axl/2)}if(axh.status==axa.BLACK){axi.fillText(axc,axk/2,axl/2)}if(axh.status==-1){axi.fillText(axj,axk/2,axl/2)}}window.setInterval(axm,100);